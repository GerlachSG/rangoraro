<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RangoRaro Admin</title>
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/eduardoamjunior/cdn-rangoraro@main/icon/logo-aba.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../css/header.css">
    <link rel="stylesheet" href="../../css/admin.css">
    <style>
        /* Estilos para gerenciar as telas de loading e login */
        .screen-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: calc(100vh - 9vh); /* Altura total menos o header */
            text-align: center;
            flex-direction: column;
        }
        .auth-modal {
            background-color: #2B2222;
            padding: 2rem 3rem;
            border-radius: 10px;
            border: 1px solid #444;
        }
        .auth-modal h2 { margin-bottom: 0.5rem; }
        .auth-modal p { margin-bottom: 1.5rem; opacity: 0.7; }
        #google-login-btn {
            background-color: #4285F4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        #google-login-btn:hover { background-color: #357ae8; }
    </style>
</head>
<body>
    <!-- Header Fixo -->
    <header class="header">
        <a href="../index.html" class="logo">
            <img src="https://cdn.jsdelivr.net/gh/eduardoamjunior/cdn-rangoraro@main/icon/logo.svg" alt="Logo RangoRaro">
            <span>RangoRaro Painel</span>
        </a>
    </header>

    <!-- TELA DE CARREGAMENTO (Visível por padrão) -->
    <div id="loading-screen" class="screen-container">
        <h2>Verificando permissões...</h2>
        <p>Por favor, aguarde enquanto validamos seu acesso de administrador.</p>
    </div>

    <!-- TELA DE LOGIN (Escondida por padrão) -->
    <div id="login-screen" class="screen-container" style="display: none;">
        <div class="auth-modal">
            <h2>Parte Administrativa do Rango Raro</h2>
            <p>Entre com uma conta de administrador para continuar.</p>
            <button id="google-login-btn">
                <img src="https://cdn.jsdelivr.net/gh/eduardoamjunior/cdn-rangoraro@main/icon/google.svg" alt="Google">
                Entrar com <b>Google</b></button>
        </div>
    </div>
    
    <!-- CONTEÚDO PRINCIPAL / DASHBOARD (Escondido por padrão) -->
    <div class="main-container" id="main-content" style="display: none;">
        <div class="main-content">
            <div class="filters-bar">
                <select id="period-selector" aria-label="Período">
                    <option value="today">Hoje</option>
                    <option value="3days">3 dias</option>
                    <option value="7days">7 dias</option>
                    <option value="1month">1 mês</option>
                    <option value="6months">6 meses</option>
                </select>
            </div>
            <section class="secao-destaques">
                <div class="top-cards-row">
                    <div class="lucro-card lucro-main" id="card-profit">
                        <div class="card-head">
                            <h3><i class="fas fa-chart-line"></i> Lucro</h3>
                            <button class="breakdown-toggle" id="btn-profit-breakdown" aria-expanded="false" title="Detalhar">▾</button>
                        </div>
                        <p id="total-profit" class="value-lg">R$ 0,00</p>
                        <div class="profit-breakdown" id="profit-breakdown" hidden>
                            <div class="bd-row"><span class="bd-label">Depósitos</span><span class="bd-value" id="bd-deposits">R$ 0,00</span></div>
                            <div class="bd-row"><span class="bd-label">Custos Viagem+Itens</span><span class="bd-value negativo" id="bd-delivery-cost">- R$ 0,00</span></div>
                            <div class="bd-row"><span class="bd-label">Saques</span><span class="bd-value negativo" id="bd-withdrawals">- R$ 0,00</span></div>
                            <div class="bd-total"><span class="bd-label">Lucro</span><span class="bd-value" id="bd-profit-final">R$ 0,00</span></div>
                        </div>
                    </div>
                    <div class="lucro-card" id="card-deposits">
                        <h3><i class="fas fa-dollar-sign"></i> Depósitos</h3>
                        <p id="total-deposits" class="value-lg">R$ 0,00</p>
                    </div>
                </div>
                <div class="second-cards-row">
                    <div class="lucro-card" id="card-withdrawals">
                        <h3><i class="fas fa-arrow-down"></i> Saques</h3>
                        <p id="total-withdrawals" class="value-md">R$ 0,00</p>
                    </div>
                    <div class="lucro-card" id="card-delivery-cost">
                        <h3><i class="fas fa-truck"></i> Custos Viagem+Itens</h3>
                        <p id="total-delivery-cost" class="value-md">R$ 0,00</p>
                    </div>
                </div>
            </section>
            <!-- KPIs Extras -->
            <section class="kpi-groups" id="kpi-grid">
                <div class="kpi-group" id="grp-users">
                    <h4 class="kpi-group-title">Usuários</h4>
                    <div class="kpi-card"><span class="kpi-label">Total Usuários</span><span class="kpi-value" id="kpi-total-users">-</span><span class="kpi-sub" id="kpi-total-users-sub">—</span></div>
                    <div class="kpi-card"><span class="kpi-label">Novos Usuários</span><span class="kpi-value" id="kpi-new-users">-</span><span class="kpi-sub" id="kpi-new-users-sub">—</span></div>
                    <div class="kpi-card"><span class="kpi-label">Usuários Ativos</span><span class="kpi-value" id="kpi-active-users">-</span><span class="kpi-sub" id="kpi-active-users-sub">—</span></div>
                    <div class="kpi-card balance-card"><span class="kpi-label">Saldo Total Usuários</span><span class="kpi-value" id="kpi-total-balance">R$ 0,00</span><span class="kpi-sub" id="kpi-total-balance-sub">—</span></div>
                </div>
                <div class="kpi-group" id="grp-deposits">
                    <h4 class="kpi-group-title">Depósitos</h4>
                    <div class="kpi-card kpi-avg-deposit-card"><span class="kpi-label">Valor Médio Depósito</span><span class="kpi-value" id="kpi-avg-deposit">R$ 0,00</span><span class="kpi-sub" id="kpi-avg-deposit-sub">—</span></div>
                    <div class="kpi-card"><span class="kpi-label">Uso Referral</span><span class="kpi-value" id="kpi-referral-usage">0%</span><span class="kpi-sub" id="kpi-referral-usage-sub">—</span></div>
                </div>
                <div class="kpi-group" id="grp-deliveries">
                    <h4 class="kpi-group-title">Entregas</h4>
                    <div class="kpi-card"><span class="kpi-label">Pedidos Abertos</span><span class="kpi-value" id="kpi-open-orders">-</span><span class="kpi-sub" id="kpi-open-orders-sub">—</span></div>
                    <div class="kpi-card"><span class="kpi-label">Tempo Médio Entrega</span><span class="kpi-value" id="kpi-delivery-time">--:--</span><span class="kpi-sub" id="kpi-delivery-time-sub">—</span></div>
                    <div class="kpi-card"><span class="kpi-label">Pago a Entregadores</span><span class="kpi-value" id="kpi-payout-entregadores">R$ 0,00</span><span class="kpi-sub" id="kpi-payout-entregadores-sub">—</span></div>
                    <div class="kpi-card"><span class="kpi-label">Total Entregas</span><span class="kpi-value" id="total-deliveries">0</span><span class="kpi-sub" id="kpi-deliveries-sub">—</span></div>
                    <div class="kpi-card clickable" id="delivery-rating-card" data-rating-type="delivery">
                        <span class="kpi-label">Avaliação Média Entregadores</span>
                        <span class="kpi-value" id="avg-rating-value">0.0 ⭐</span>
                        <span class="kpi-sub" id="avg-rating-sub">—</span>
                    </div>
                </div>
                <div class="kpi-group" id="grp-support">
                    <h4 class="kpi-group-title">Suporte</h4>
                    <div class="kpi-card"><span class="kpi-label">Chats Abertos</span><span class="kpi-value" id="kpi-open-chats">-</span><span class="kpi-sub" id="kpi-open-chats-sub">—</span></div>
                    <div class="kpi-card"><span class="kpi-label">Tempo Médio Resposta</span><span class="kpi-value" id="kpi-support-time">--:--</span><span class="kpi-sub" id="kpi-support-time-sub">—</span></div>
                    <div class="kpi-card clickable" id="support-rating-card" data-rating-type="support">
                        <span class="kpi-label">Avaliação Média</span>
                        <span class="kpi-value" id="kpi-support-rating">0.0 ⭐</span>
                        <span class="kpi-sub" id="kpi-support-rating-sub">—</span>
                    </div>
                </div>
            </section>

            <!-- Gráficos -->
            <section class="charts-grid">
                <div class="chart-card">
                    <h4>Depósitos / Dia</h4>
                    <canvas id="chart-deposits"></canvas>
                </div>
                <div class="chart-card">
                    <h4>Pedidos / Status</h4>
                    <canvas id="chart-orders-status"></canvas>
                </div>
            </section>

            <!-- Listas / Tabelas -->
            <section class="lists-grid">
                <div class="list-card">
                    <h4>Últimos Depósitos</h4>
                    <ul id="list-latest-deposits" class="mini-list"></ul>
                </div>
                <div class="list-card">
                    <h4>Pedidos Recentes</h4>
                    <ul id="list-recent-orders" class="mini-list"></ul>
                </div>
                <div class="list-card">
                    <h4>Ganhos Recentes</h4>
                    <ul id="list-recent-drops" class="mini-list"></ul>
                </div>
                <div class="list-card">
                    <h4>Chats Suporte Abertos</h4>
                    <ul id="list-open-chats" class="mini-list"></ul>
                </div>
            </section>


        </div>
    </div>

    <!-- Rating Details Modal -->
    <div id="rating-modal" class="rating-modal">
        <div class="rating-modal-content">
            <div class="rating-modal-header">
                <h3 id="rating-modal-title">Avaliações de Entregas</h3>
                <button class="rating-close" id="rating-modal-close">×</button>
            </div>
            <div class="rating-summary">
                <div class="rating-avg">
                    <div class="rating-avg-number" id="rating-avg-number">0.0</div>
                    <div class="rating-avg-stars" id="rating-avg-stars">☆☆☆☆☆</div>
                    <div class="rating-avg-total" id="rating-avg-total">0 avaliações</div>
                </div>
                <div class="rating-breakdown">
                    <div class="rating-bar-row">
                        <div class="rating-bar-label">5 ⭐</div>
                        <div class="rating-bar-track"><div class="rating-bar-fill" id="bar-5" style="width: 0%"></div></div>
                        <div class="rating-bar-count" id="count-5">0</div>
                    </div>
                    <div class="rating-bar-row">
                        <div class="rating-bar-label">4 ⭐</div>
                        <div class="rating-bar-track"><div class="rating-bar-fill" id="bar-4" style="width: 0%"></div></div>
                        <div class="rating-bar-count" id="count-4">0</div>
                    </div>
                    <div class="rating-bar-row">
                        <div class="rating-bar-label">3 ⭐</div>
                        <div class="rating-bar-track"><div class="rating-bar-fill" id="bar-3" style="width: 0%"></div></div>
                        <div class="rating-bar-count" id="count-3">0</div>
                    </div>
                    <div class="rating-bar-row">
                        <div class="rating-bar-label">2 ⭐</div>
                        <div class="rating-bar-track"><div class="rating-bar-fill" id="bar-2" style="width: 0%"></div></div>
                        <div class="rating-bar-count" id="count-2">0</div>
                    </div>
                    <div class="rating-bar-row">
                        <div class="rating-bar-label">1 ⭐</div>
                        <div class="rating-bar-track"><div class="rating-bar-fill" id="bar-1" style="width: 0%"></div></div>
                        <div class="rating-bar-count" id="count-1">0</div>
                    </div>
                </div>
            </div>
            <div class="rating-filters">
                <button class="rating-filter-btn active" data-filter="all">Todas</button>
                <button class="rating-filter-btn" data-filter="5">5 Estrelas</button>
                <button class="rating-filter-btn" data-filter="4">4 Estrelas</button>
                <button class="rating-filter-btn" data-filter="3">3 Estrelas</button>
                <button class="rating-filter-btn" data-filter="2">2 Estrelas</button>
                <button class="rating-filter-btn" data-filter="1">1 Estrela</button>
            </div>
            <div class="rating-list" id="rating-list">
                <div class="rating-empty">Carregando avaliações...</div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script defer src="../../js/admin.js"></script>
</body>
</html>

